#!/usr/bin/env bash

# Use yt-dlp if available, fall back to youtube-dl
if command -v yt-dlp &>/dev/null; then
    DOWNLOADER="yt-dlp"
elif command -v youtube-dl &>/dev/null; then
    DOWNLOADER="youtube-dl"
else
    echo "Error: Neither yt-dlp nor youtube-dl is installed."
    echo "Install yt-dlp: pip install yt-dlp"
    exit 1
fi

URL=$1

$DOWNLOADER --download-archive downloaded.txt \
    -i \
    --no-post-overwrites \
    -f bestaudio \
    --audio-quality 0 \
    -ciwx \
    --extract-audio \
    --audio-format mp3 \
    -o "%(title)s.%(ext)s" \
    --embed-thumbnail \
    --add-metadata $URL
